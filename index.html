<script>
  window.addEventListener('load', async () => {
    const views = {
      'home-page': document.getElementById('home-page-view'),
      'games': document.getElementById('games-view'),
      'game': document.getElementById('game-view'),
      'settings': document.getElementById('settings-view'),
      'proxy': document.getElementById('proxy-view')
    };
    const navButtons = document.querySelectorAll('.nav-button');
    const gameIframe = document.getElementById('game-iframe');

    // === SCRAMJET PROXY INIT ===
    const { ScramjetController } = $scramjetLoadController();
    const scramjet = new ScramjetController({
      files: {
        wasm: "/scram/scramjet.wasm.wasm",
        all: "/scram/scramjet.all.js",
        sync: "/scram/scramjet.sync.js",
      }
    });
    await scramjet.init();

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js');
    }

    // === PROXY GO BUTTON ===
    document.getElementById('go-proxy').addEventListener('click', () => {
      let url = document.getElementById('proxy-url').value.trim();
      if (!url) return alert('Enter a URL');
      if (!url.includes('://')) url = 'https://' + url;
      const encoded = scramjet.codec.encode(url);
      gameIframe.src = `/scram/${encoded}`;
      showView('game');
    });

    // === YOUR ORIGINAL JS (typewriter, particles, etc.) ===
    const gradientWord = document.getElementById('gradient-word');
    const words = ['silly.', 'freedom.', 'beauty.', 'peace.', 'amazement.', 'fun.'];
    let wordIndex = 0, charIndex = 0, isDeleting = false, typingTimeout;
    const type = () => {
      const currentWord = words[wordIndex];
      const displayText = isDeleting ? currentWord.substring(0, charIndex - 1) : currentWord.substring(0, charIndex + 1);
      gradientWord.textContent = displayText;
      let typeSpeed = 120;
      if (isDeleting) typeSpeed /= 2;
      if (!isDeleting && charIndex === currentWord.length) { typeSpeed = 2500; isDeleting = true; }
      else if (isDeleting && charIndex === 0) { isDeleting = false; wordIndex = (wordIndex + 1) % words.length; typeSpeed = 500; }
      charIndex = isDeleting ? charIndex - 1 : charIndex + 1;
      typingTimeout = setTimeout(type, typeSpeed);
    };
    type();

    window.showView = function(name) {
      Object.values(views).forEach(v => v.classList.add('hidden-view'));
      views[name].classList.remove('hidden-view');
      navButtons.forEach(b => {
        const isActive = b.dataset.view === name;
        b.classList.toggle('bg-purple-600/30', isActive && !b.classList.contains('proxy-tab'));
        b.classList.toggle('text-white', isActive);
        b.classList.toggle('text-gray-300', !isActive && !b.classList.contains('proxy-tab'));
      });
    };
    navButtons.forEach(btn => btn.addEventListener('click', () => showView(btn.dataset.view)));

    // === KEEP ALL YOUR OTHER JS (particles, themes, etc.) BELOW ===
    // DO NOT DELETE ANYTHING ELSE
  });
</script>
